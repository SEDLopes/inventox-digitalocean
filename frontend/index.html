<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Mobile Optimization -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Camera permissions -->
    <meta http-equiv="Permissions-Policy" content="camera=*">
    
    <title>InventoX - Sistema de Inventário</title>
    <!-- Tailwind CSS via CDN (para desenvolvimento) -->
    <!-- TODO: Em produção, compilar Tailwind CSS localmente -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ZXing Library - usar versão específica em produção -->
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <!-- Configuração da aplicação -->
    <script src="config.js"></script>
    <style>
        /* Mobile-specific styles */
        @media (max-width: 768px) {
            .toast {
                position: fixed !important;
                top: 20px !important;
                left: 10px !important;
                right: 10px !important;
                z-index: 9999 !important;
                font-size: 16px !important;
            }
            
            /* Prevent zoom on input focus */
            input, select, textarea {
                font-size: 16px !important;
            }
            
            /* Better touch targets */
            button, .btn {
                min-height: 44px !important;
                min-width: 44px !important;
            }
            
            /* Scanner video optimization */
            #scanner video {
                width: 100% !important;
                height: auto !important;
                max-height: 60vh !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-gray-700">A carregar...</p>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="bg-blue-600 text-white p-4">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <img src="/frontend/assets/logo.svg" alt="InventoX Logo" class="h-8 w-8" onerror="this.style.display='none'">
                <h1 class="text-xl font-bold">InventoX</h1>
            </div>
            <div class="flex space-x-4 items-center">
                <span id="userInfo" class="text-sm hidden"></span>
                <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded hidden">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Login Screen -->
    <div id="loginSection" class="container mx-auto mt-8 p-4 max-w-md">
        <div class="bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-bold mb-6 text-center">Login</h2>
            <div id="loginError" class="mb-4 text-red-600 text-sm hidden"></div>
            <form id="loginForm">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Username:</label>
                    <input type="text" id="username" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password:</label>
                    <input type="password" id="password" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                </div>
                <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                    Login
                </button>
            </form>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboardSection" class="container mx-auto mt-8 p-4 hidden">
        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-6">
            <div class="flex border-b overflow-x-auto">
                <button class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="dashboard">
                    Dashboard
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-blue-500 text-blue-600 font-medium whitespace-nowrap" data-tab="scanner">
                    Scanner
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="items">
                    Artigos
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="categories">
                    Categorias
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="sessions">
                    Sessões
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="import">
                    Importar
                </button>
                <button id="historyTabBtn" class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="history">
                    Histórico
                </button>
                <button id="usersTabBtn" class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap hidden" data-tab="users">
                    Utilizadores
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="companies">
                    Empresas
                </button>
                <button class="tab-btn flex-1 py-3 px-4 text-center border-b-2 border-transparent text-gray-500 hover:text-gray-700 whitespace-nowrap" data-tab="warehouses">
                    Armazéns
                </button>
            </div>
        </div>

        <!-- Scanner Tab -->
        <div id="scannerTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-bold mb-4">Scanner de Código de Barras</h3>
                
                <!-- Camera Controls -->
                <div class="mb-4 flex flex-wrap gap-2">
                    <button id="startScannerBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Iniciar Scanner
                    </button>
                    <button id="stopScannerBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded hidden">
                        Parar Scanner
                    </button>
                    <button id="switchCameraBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded hidden">
                        Trocar Câmara
                    </button>
                    <select id="cameraSelect" class="px-3 py-2 border rounded hidden">
                        <option value="">Selecionar Câmara</option>
                    </select>
                </div>

                <!-- Scanner Video -->
                <div id="scanner" class="mb-4 hidden">
                    <video id="scannerVideo" class="w-full max-w-md mx-auto border rounded" playsinline muted></video>
                </div>
                
                <!-- Scanner Placeholder -->
                <div id="scannerPlaceholder" class="mb-4 p-8 bg-gray-50 rounded-lg text-center border-2 border-dashed border-gray-300">
                    <p class="text-gray-500">Clique em "Iniciar Scanner" para começar a digitalizar códigos de barras</p>
                </div>
                
                <!-- Scanner Status -->
                <div id="scannerStatus" class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="text-green-800 font-semibold">Scanner Ativo</h4>
                            <p class="text-green-600 text-sm" id="scannerStatusText">Pronto para escanear códigos de barras</p>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                            <span class="text-green-700 text-sm font-medium">Ativo</span>
                        </div>
                    </div>
                </div>

                <!-- Manual Input -->
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Ou digite o código manualmente:</label>
                    <div class="flex">
                        <input type="text" id="manualBarcode" class="flex-1 px-3 py-2 border rounded-l-lg focus:outline-none focus:border-blue-500" placeholder="Código de barras">
                        <button id="processManualBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-r-lg">
                            Processar
                        </button>
                    </div>
                </div>

                <!-- Session Selection -->
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Sessão Ativa:</label>
                    <select id="sessionSelect" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                        <option value="">Selecionar sessão...</option>
                    </select>
                </div>

                <!-- Clear Session Button -->
                <div class="mb-4">
                    <button id="clearSessionBtn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded">
                        Limpar Sessão
                    </button>
                </div>
            </div>

            <!-- Scanned Items -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Itens Digitalizados</h3>
                <div id="scannedItems" class="space-y-2">
                    <!-- Scanned items will appear here -->
                </div>
                <div class="mt-4">
                    <button id="saveCountBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded hidden">
                        Guardar Contagem
                    </button>
                </div>
            </div>
        </div>

        <!-- Items Tab -->
        <div id="itemsTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gestão de Artigos</h3>
                    <button id="addItemBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Adicionar Artigo
                    </button>
                </div>
                
                <!-- Search -->
                <div class="mb-4">
                    <input type="text" id="itemSearch" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Pesquisar artigos...">
                </div>

                <!-- Items List -->
                <div id="itemsList" class="space-y-2">
                    <!-- Items will be loaded here -->
                </div>
                
                <!-- Items Pagination -->
                <div id="itemsPagination" class="mt-4 flex justify-center">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Sessions Tab -->
        <div id="sessionsTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Sessões de Inventário</h3>
                    <button id="createSessionBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Nova Sessão
                    </button>
                </div>

                <!-- Sessions List -->
                <div id="sessionsList" class="space-y-2">
                    <!-- Sessions will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Import Tab -->
        <div id="importTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Importar Artigos</h3>
                
                <form id="importForm" enctype="multipart/form-data">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Ficheiro Excel (.xlsx):</label>
                        <input type="file" id="importFile" accept=".xlsx,.xls" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <button type="submit" id="uploadBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                        Importar
                    </button>
                </form>

                <div id="importResults" class="mt-4 hidden">
                    <!-- Import results will appear here -->
                </div>
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboardTab" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-sm font-medium text-gray-500 mb-2">Total de Artigos</h3>
                    <p class="text-2xl font-bold text-blue-600" id="statTotalItems">0</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-sm font-medium text-gray-500 mb-2">Stock Baixo</h3>
                    <p class="text-2xl font-bold text-red-600" id="statLowStock">0</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-sm font-medium text-gray-500 mb-2">Sessões Abertas</h3>
                    <p class="text-2xl font-bold text-green-600" id="statOpenSessions">0</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="text-sm font-medium text-gray-500 mb-2">Valor do Inventário</h3>
                    <p class="text-2xl font-bold text-purple-600" id="statInventoryValue">0 CVE</p>
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-lg font-bold mb-4">Artigos com Stock Baixo</h3>
                <div id="lowStockList" class="space-y-2">
                    <!-- Low stock items will appear here -->
                </div>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Top 5 Categorias</h3>
                <div id="topCategoriesList" class="space-y-2">
                    <!-- Top categories will appear here -->
                </div>
            </div>
        </div>

        <!-- Categories Tab -->
        <div id="categoriesTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gestão de Categorias</h3>
                    <button id="createCategoryBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Nova Categoria
                    </button>
                </div>
                
                <!-- Search -->
                <div class="mb-4">
                    <input type="text" id="categorySearch" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Pesquisar categorias...">
                </div>

                <!-- Categories List -->
                <div id="categoriesList" class="space-y-2">
                    <!-- Categories will be loaded here -->
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div id="historyTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-lg font-bold mb-4">Histórico de Movimentos de Stock</h3>
                
                <!-- Filters -->
                <div class="mb-4 grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Tipo:</label>
                        <select id="historyType" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option value="">Todos</option>
                            <option value="entrada">Entrada</option>
                            <option value="saida">Saída</option>
                            <option value="ajuste">Ajuste</option>
                            <option value="transferencia">Transferência</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Data Início:</label>
                        <input type="date" id="historyDateFrom" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Data Fim:</label>
                        <input type="date" id="historyDateTo" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="flex items-end">
                        <button onclick="loadStockHistory(1)" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Filtrar
                        </button>
                    </div>
                </div>
                
                <div id="historyList" class="space-y-2">
                    <!-- Stock history will be loaded here -->
                </div>
                
                <div id="historyPagination" class="mt-4 flex justify-center gap-2">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Users Tab -->
        <div id="usersTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gestão de Utilizadores</h3>
                    <button id="createUserBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Novo Utilizador
                    </button>
                </div>
                
                <!-- Search -->
                <div class="mb-4">
                    <input type="text" id="usersSearch" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Pesquisar utilizadores...">
                </div>

                <!-- Users List -->
                <div id="usersList" class="space-y-2">
                    <!-- Users will be loaded here -->
                </div>
                
                <div id="usersPagination" class="mt-4 flex justify-center gap-2">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Companies Tab -->
        <div id="companiesTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gestão de Empresas</h3>
                    <button id="createCompanyBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Nova Empresa
                    </button>
                </div>
                
                <!-- Companies List -->
                <div id="companiesList" class="space-y-2">
                    <!-- Companies will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Warehouses Tab -->
        <div id="warehousesTab" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Gestão de Armazéns</h3>
                    <button id="createWarehouseBtn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Novo Armazém
                    </button>
                </div>
                
                <!-- Warehouses List -->
                <div id="warehousesList" class="space-y-2">
                    <!-- Warehouses will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Count Setup Modal -->
    <div id="countSetupModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Configurar Contagem</h3>
                    <button onclick="closeCountSetupModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="countSetupForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Empresa <span class="text-red-500">*</span>:</label>
                        <select id="setupCompanySelect" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                            <option value="">Carregando empresas...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Armazém <span class="text-red-500">*</span>:</label>
                        <select id="setupWarehouseSelect" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500 bg-gray-100" disabled required>
                            <option value="">Primeiro selecione uma empresa</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Sessão:</label>
                        <select id="setupSessionSelect" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500 bg-gray-100" disabled>
                            <option value="">Primeiro selecione empresa e armazém</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <button type="button" id="setupCreateNewSessionBtn" onclick="toggleNewSessionForm()" class="text-blue-500 hover:text-blue-700 text-sm font-medium hidden">
                            + Criar Nova Sessão
                        </button>
                    </div>
                    <div id="setupNewSessionForm" class="mb-4 hidden border-t pt-4">
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nome da Sessão <span class="text-red-500">*</span>:</label>
                            <input type="text" id="setupSessionName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Ex: Inventário Janeiro 2024">
                        </div>
                        <div class="mb-4">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
                            <textarea id="setupSessionDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3" placeholder="Descrição opcional da sessão"></textarea>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeCountSetupModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="button" onclick="confirmCountSetup()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Iniciar Scanner
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Session Details Modal -->
    <div id="sessionDetailsCard" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Detalhes da Sessão</h3>
                    <button id="closeSessionDetails" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <div id="sessionDetailsContent">
                    <!-- Session details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Item Info Card -->
    <div id="itemInfoCard" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Informações do Artigo</h3>
                    <button onclick="closeItemInfo()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <div id="itemInfoContent">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Código de Barras:</label>
                            <p id="scannerItemBarcode" class="text-gray-900 font-mono">-</p>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Nome do Artigo:</label>
                            <p id="scannerItemName" class="text-gray-900">-</p>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade Atual:</label>
                            <p id="scannerItemQuantity" class="text-gray-900">-</p>
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade Contada:</label>
                            <input type="number" id="countedQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" min="0" value="0">
                        </div>
                        <div>
                            <label class="block text-gray-700 text-sm font-bold mb-2">Código Manual:</label>
                            <input type="text" id="itemCardManualBarcode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" placeholder="Digite o código manualmente">
                        </div>
                        <div class="flex justify-end space-x-2">
                            <button onclick="closeItemInfo()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                                Cancelar
                            </button>
                            <button onclick="saveCount()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                                Guardar Contagem
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals and Forms (Add Item, Create Session, etc.) -->
    <!-- Add Item Modal -->
    <div id="addItemModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Adicionar Artigo</h3>
                    <button id="closeAddItem" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="addItemForm">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Código de Barras:</label>
                        <input type="text" id="newItemBarcode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome:</label>
                        <input type="text" id="newItemName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
                        <textarea id="newItemDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade:</label>
                        <input type="number" id="newItemQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Preço Unitário:</label>
                        <input type="number" id="newItemPrice" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0" step="0.01">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Localização:</label>
                        <input type="text" id="newItemLocation" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancelAddItem" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Adicionar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Session Modal -->
    <div id="createSessionModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold">Nova Sessão</h3>
                    <button id="closeCreateSession" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="createSessionForm" novalidate>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Empresa <span class="text-red-500">*</span>:</label>
                        <select id="newSessionCompany" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                            <option value="">Carregando empresas...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Armazém <span class="text-red-500">*</span>:</label>
                        <select id="newSessionWarehouse" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500 bg-gray-100" disabled required>
                            <option value="">Primeiro selecione uma empresa</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome da Sessão <span class="text-red-500">*</span>:</label>
                        <input type="text" id="newSessionName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
                        <textarea id="newSessionDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" id="cancelCreateSession" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Criar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Category Modal -->
    <div id="categoryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="categoryModalTitle" class="text-lg font-bold">Nova Categoria</h3>
                    <button onclick="closeCategoryModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="categoryForm">
                    <input type="hidden" id="categoryId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome <span class="text-red-500">*</span>:</label>
                        <input type="text" id="categoryName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
                        <textarea id="categoryDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3"></textarea>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeCategoryModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- User Modal -->
    <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="userModalTitle" class="text-lg font-bold">Novo Utilizador</h3>
                    <button onclick="closeUserModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="userForm">
                    <input type="hidden" id="userId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Username <span class="text-red-500">*</span>:</label>
                        <input type="text" id="userUsername" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Email <span class="text-red-500">*</span>:</label>
                        <input type="email" id="userEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Password <span id="passwordRequired" class="text-red-500">*</span>:</label>
                        <input type="password" id="userPassword" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                        <p class="text-xs text-gray-500 mt-1">Deixe em branco para manter a password atual (ao editar)</p>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Role:</label>
                        <select id="userRole" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option value="operator">Operador</option>
                            <option value="admin">Administrador</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="userIsActive" class="mr-2" checked>
                            <span class="text-gray-700 text-sm font-bold">Ativo</span>
                        </label>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeUserModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Company Modal -->
    <div id="companyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="companyModalTitle" class="text-lg font-bold">Nova Empresa</h3>
                    <button onclick="closeCompanyModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="companyForm">
                    <input type="hidden" id="companyId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome <span class="text-red-500">*</span>:</label>
                        <input type="text" id="companyName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Código:</label>
                        <input type="text" id="companyCode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Morada:</label>
                        <textarea id="companyAddress" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="2"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Telefone:</label>
                        <input type="text" id="companyPhone" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                        <input type="email" id="companyEmail" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">NIF:</label>
                        <input type="text" id="companyTaxId" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="companyActive" class="mr-2" checked>
                            <span class="text-gray-700 text-sm font-bold">Ativo</span>
                        </label>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeCompanyModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Warehouse Modal -->
    <div id="warehouseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="warehouseModalTitle" class="text-lg font-bold">Novo Armazém</h3>
                    <button onclick="closeWarehouseModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="warehouseForm">
                    <input type="hidden" id="warehouseId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Empresa <span class="text-red-500">*</span>:</label>
                        <select id="warehouseCompany" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                            <option value="">Selecionar empresa...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome <span class="text-red-500">*</span>:</label>
                        <input type="text" id="warehouseName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Código:</label>
                        <input type="text" id="warehouseCode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Morada:</label>
                        <textarea id="warehouseAddress" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="2"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Localização:</label>
                        <input type="text" id="warehouseLocation" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" id="warehouseActive" class="mr-2" checked>
                            <span class="text-gray-700 text-sm font-bold">Ativo</span>
                        </label>
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeWarehouseModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Item Modal (for editing) -->
    <div id="itemModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="itemModalTitle" class="text-lg font-bold">Editar Artigo</h3>
                    <button onclick="closeItemModal()" class="text-gray-500 hover:text-gray-700 text-xl">&times;</button>
                </div>
                <form id="itemForm">
                    <input type="hidden" id="itemId" value="">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Código de Barras <span class="text-red-500">*</span>:</label>
                        <input type="text" id="itemBarcode" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Nome <span class="text-red-500">*</span>:</label>
                        <input type="text" id="itemName" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Descrição:</label>
                        <textarea id="itemDescription" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" rows="3"></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Categoria:</label>
                        <select id="itemCategory" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                            <option value="">Selecionar categoria...</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade:</label>
                        <input type="number" id="itemQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Quantidade Mínima:</label>
                        <input type="number" id="itemMinQuantity" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Preço Unitário:</label>
                        <input type="number" id="itemPrice" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" value="0" min="0" step="0.01">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Localização:</label>
                        <input type="text" id="itemLocation" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Fornecedor:</label>
                        <input type="text" id="itemSupplier" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" onclick="closeItemModal()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                            Guardar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <span id="toastMessage"></span>
    </div>

    <script src="validators.js?v=1.0"></script>
    <script src="app.js?v=1.19"></script>
</body>
</html>